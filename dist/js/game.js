"use strict";function ownKeys(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,s)}return i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach(function(e){_defineProperty(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var Game=function(){function t(e){_classCallCheck(this,t),this.myCanvas=document.querySelector("#game"),this.ctx=this.myCanvas.getContext("2d"),this.viewWidth=parseInt(window.innerWidth||document.documentElement.clientWidth),this.viewHeight=parseInt(window.innerHeight||document.documentElement.clientHeight),this.dataURL="../js/resourses.json",this.imgsURL={},this.imgCache={},this.timer=null,this._interval=20,this.is_built=!1,this.is_crashed=!1,this.is_start=!1,this.gameItems=[],this.speed=0,this.score=0,this.best=0,this.myCanvas.setAttribute("width",this.viewWidth),this.myCanvas.setAttribute("height",this.viewHeight),this.getData(this.init)}return _createClass(t,[{key:"getData",value:function(t){var e=this,i=new XMLHttpRequest;i.open("GET",this.dataURL),i.send(),i.addEventListener("readystatechange",function(){4!=i.readyState||200!=i.status&&304!=i.status||function(){e.imgsURL=_objectSpread({},JSON.parse(i.responseText));var s=0,n=Object.keys(e.imgsURL).length;for(var r in e.imgsURL)e.imgCache[r]=new Image,e.imgCache[r].src=e.imgsURL[r],e.imgCache[r].addEventListener("load",function(){e.ctx.clearRect(0,0,e.viewWidth,e.viewHeight),s++,e.ctx.font="30px impact",e.ctx.textAlign="center",e.ctx.fillText("Loading...(".concat(s,"/").concat(n,")"),e.viewWidth/2,.382*e.viewHeight),s==n&&t.call(e)})}()})}},{key:"init",value:function(){var t=this;this.bg=new Background,this.floor=new Floor,this.bird=new Bird,this.title=new Title,this.gameover=new Gameover,this.myCanvas.onclick=this.start.bind(this),this.timer=setInterval(function(){t.ctx.clearRect(0,0,t.viewWidth,t.viewHeight),t.is_crashed&&(t.speed=0,t.myCanvas.onclick=null,t.bird.is_picked=!1,t.bg.is_picked=!1),!t.is_built&&t.is_start&&(t.is_built=!0,setTimeout(function(){t.is_built=!1},3e3),new Pipes),t.gameItems.forEach(function(t){t.update(),t.render()}),t.ctx.save(),t.ctx.textAlign="center",t.ctx.fillStyle="white",t.ctx.strokeStyle="grey",t.ctx.lineWidth=2,t.ctx.fillText(t.score,t.viewWidth/2,50),t.ctx.strokeText(t.score,t.viewWidth/2,50),t.ctx.restore(),t.score>t.best&&(t.best=t.score),t.ctx.save(),t.ctx.font="14px impact",t.ctx.textAlign="center",t.ctx.fillStyle="white",t.ctx.fillText("Best: "+t.best,7*t.viewWidth/8,38),t.ctx.restore()},this._interval)}},{key:"start",value:function(){this.is_start=!0,this.is_crashed=!1,this.speed=100*parseFloat((this._interval/1e3).toFixed(2)),this.bird.start(),this.bg.start(),this.myCanvas.onclick=this.bird.jump.bind(this.bird),this.score=0}}]),t}();